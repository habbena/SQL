DROP table V_INDICATORS_MONTH;

DROP TABLE V_INDICATORS_DAY;

DROP table v_whs;




CREATE table v_whs(
	whs_id serial PRIMARY KEY,
	open_dt date not NULL,
	name varchar NOT NULL,
	frmt_id int NOT NULL,
	subfrmt int NOT NULL,
	square_trade NUMERIC NOT NULL,
	working int NOT NULL,
	potential NUMERIC NOT NULL,
	region varchar NOT NULL,
	branch varchar NOT NULL,
	city varchar NOT NULL,
	size_of_population int NOT NULL
);


INSERT INTO v_whs (open_dt, name, frmt_id, subfrmt, square_trade, working, potential, region, branch, city, size_of_population)
VALUES 
('2019-01-20', 'Монтаж', 1, 3, 400, 1, 100, 'South', 'Krasodarskiy', 'Ахтырск', 100),
('2019-06-14', 'Авторучка', 1, 1, 620, 1, 600, 'South', 'Krasodarskiy', 'Краснодар', 500),
('2019-01-20', 'Шанс', 1, 3, 80, 1, 100, 'South', 'Krasodarskiy', 'Ахтырск', 8),
('2019-06-14', 'Лес', 1, 1, 120, 1, 600, 'South', 'Krasodarskiy', 'Марьянская', 25),
('2019-06-14', 'Плес', 1, 1, 200, 1, 600, 'South', 'Krasodarskiy', 'Каневская', 80),
('2020-01-20', 'Гипер', 2, 3, 80, 1, 100, 'South', 'Krasodarskiy', 'Ахтырск', 8),
('2020-02-20', 'Микро', 1, 3, 140, 1, 100, 'South', 'Krasodarskiy', 'Каменск', 120),
('2019-06-14', 'Лес нераб', 1, 1, 120, 0, 600, 'South', 'Krasodarskiy', 'Марьянская', 25),
('2019-06-14', 'Плес нераб', 1, 1, 200, 0, 600, 'South', 'Krasodarskiy', 'Каневская', 80);


CREATE table V_INDICATORS_MONTH(
	id serial PRIMARY KEY,
	month_id date NOT null, -- YYYY-MM
	whs_id int NOT null,
	opsum NUMERIC NOT NULL,
	txn_cnt int NOT NULL,
	sales_day_cnt int NOT NULL, -- количество отработанных дней
	FOREIGN KEY (whs_id)
		REFERENCES v_whs (whs_id) ON DELETE CASCADE
);
	
INSERT INTO V_INDICATORS_MONTH (month_id, whs_id, opsum, txn_cnt, sales_day_cnt)
VALUES 
('2021-01-01',1, 60, 20, 28),
('2021-02-01',1, 70, 20, 28),
('2021-03-01',1, 80, 20, 28),
('2021-04-01',1, 60, 20, 28),
('2021-05-01',1, 80, 20, 28),
('2021-06-01',1, 80, 20, 28),
('2021-07-01',1, 80, 20, 28),
('2021-08-01',1, 90, 20, 28),
('2021-09-01',1, 80, 20, 28),
('2021-10-01',1, 90, 20, 28),
('2021-11-01',1, 100, 20, 28),
('2021-12-01',1, 200, 20, 28),
('2022-01-01',1, 90, 20, 28),
('2022-02-01',1, 100, 20, 28),
('2022-03-01',1, 110, 20, 28),
('2022-04-01',1, 120, 20, 28),
('2022-05-01',1, 120, 20, 28),
('2022-06-01',1, 120, 20, 28),
('2022-07-01',1, 120, 20, 28),
('2022-08-01',1, 120, 20, 28),
('2022-09-01',1, 160, 20, 28),
('2022-10-01',1, 170, 20, 28),
('2022-11-01',1, 180, 20, 28),
('2022-12-01',1, 190, 20, 28),
('2021-01-01',2, 40, 20, 28),
('2021-02-01',2, 50, 20, 28),
('2021-03-01',2, 60, 20, 28),
('2021-04-01',2, 50, 20, 28),
('2021-05-01',2, 50, 20, 28),
('2021-06-01',2, 60, 20, 28),
('2021-07-01',2, 40, 20, 28),
('2021-08-01',2, 40, 20, 28),
('2021-09-01',2, 50, 20, 28),
('2021-10-01',2, 50, 20, 28),
('2021-11-01',2, 60, 20, 28),
('2021-12-01',2, 70, 20, 28),
('2022-01-01',2, 90, 20, 28),
('2022-02-01',2, 90, 20, 28),
('2022-03-01',2, 80, 20, 28),
('2022-04-01',2, 80, 20, 28),
('2022-05-01',2, 80, 20, 28),
('2022-06-01',2, 80, 20, 28),
('2022-07-01',2, 80, 20, 28),
('2022-08-01',2, 80, 20, 28),
('2022-09-01',2, 80, 20, 28),
('2022-10-01',2, 170, 20, 28),
('2022-11-01',2, 180, 20, 28),
('2022-12-01',2, 190, 20, 28),
('2021-01-01',3, 60, 20, 28),
('2021-02-01',3, 70, 20, 28),
('2021-03-01',3, 80, 20, 28),
('2021-04-01',3, 60, 20, 28),
('2021-05-01',3, 80, 20, 28),
('2021-06-01',3, 80, 20, 28),
('2021-07-01',3, 80, 20, 28),
('2021-08-01',3, 100, 20, 28),
('2021-09-01',3, 100, 20, 28),
('2021-10-01',3, 100, 20, 28),
('2021-11-01',3, 100, 20, 28),
('2021-12-01',3, 100, 20, 28),
('2022-01-01',3, 100, 20, 28),
('2022-02-01',3, 100, 20, 28),
('2022-03-01',3, 110, 20, 28),
('2022-04-01',3, 100, 20, 28),
('2022-05-01',3, 100, 20, 28),
('2022-06-01',3, 100, 20, 28),
('2022-07-01',3, 100, 20, 28),
('2022-08-01',3, 120, 20, 28),
('2022-09-01',3, 160, 20, 28),
('2022-10-01',3, 170, 20, 28),
('2022-11-01',3, 180, 20, 28),
('2022-12-01',3, 190, 20, 28),
('2021-01-01',4, 60, 20, 28),
('2021-02-01',4, 70, 20, 28),
('2021-03-01',4, 80, 20, 28),
('2021-04-01',4, 60, 20, 28),
('2021-05-01',4, 80, 20, 28),
('2021-06-01',4, 80, 20, 28),
('2021-07-01',4, 80, 20, 28),
('2021-08-01',4, 90, 20, 28),
('2021-09-01',4, 80, 20, 28),
('2021-10-01',4, 90, 20, 28),
('2021-11-01',4, 100, 20, 28),
('2021-12-01',4, 200, 20, 28),
('2022-01-01',4, 90, 20, 28),
('2022-02-01',4, 100, 20, 28),
('2022-03-01',4, 110, 20, 28),
('2022-04-01',4, 120, 20, 28),
('2022-05-01',4, 120, 20, 28),
('2022-06-01',4, 120, 20, 28),
('2022-07-01',4, 120, 20, 28),
('2022-08-01',4, 120, 20, 28),
('2022-09-01',4, 160, 20, 28),
('2022-10-01',4, 170, 20, 28),
('2022-11-01',4, 180, 20, 28),
('2022-12-01',4, 190, 20, 28);



CREATE table V_INDICATORS_DAY(
	id serial PRIMARY KEY,
	day_id date NOT null, --YYYY-MM-DD
	whs_id int NOT null,
	opsum NUMERIC NOT NULL,
	txn_cnt int NOT NULL, -- количество чеков
	FOREIGN KEY (whs_id)
		REFERENCES v_whs (whs_id) ON DELETE CASCADE
);	
	
INSERT INTO V_INDICATORS_DAY (day_id, whs_id, opsum, txn_cnt)
VALUES 
('2023-01-04',2, 80, 20),
('2023-02-03',2, 80, 20),
('2023-03-09',2, 80, 20),
('2023-04-02',2, 80, 20),
('2023-05-01',2, 80, 20),
('2023-06-17',2, 80, 20),
('2023-07-01',2, 80, 20),
('2023-07-08',2, 80, 20),
('2023-07-12',2, 80, 20),
('2023-07-21',2, 80, 20),
('2023-07-30',2, 80, 20),
('2023-09-11',2, 80, 20),
('2023-10-03',2, 80, 20),
('2023-11-08',2, 80, 20),
('2021-12-21',2, 80, 20),
('2022-01-23',2, 100, 20),
('2022-02-23',1, 100, 20),
('2022-03-10',1, 100, 20),
('2022-04-12',1, 100, 20),
('2022-05-14',1, 100, 20),
('2022-06-14',1, 100, 20),
('2022-07-15',1, 100, 20),
('2022-08-16',1, 100, 20),
('2022-09-14',1, 100, 20),
('2022-10-12',1, 100, 20),
('2022-11-21',1, 100, 20),
('2022-12-30',1, 100, 20),
('2021-01-23',2, 80, 20),
('2021-02-23',2, 80, 20),
('2021-03-01',2, 80, 20),
('2021-04-09',2, 80, 20),
('2021-05-08',2, 80, 20),
('2021-06-03',2, 80, 20),
('2021-07-06',2, 80, 20),
('2021-08-15',2, 80, 20),
('2021-09-11',2, 80, 20),
('2021-10-15',2, 80, 20),
('2021-11-16',2, 80, 20),
('2021-12-14',2, 80, 20),
('2022-01-16',2, 100, 20),
('2022-02-14',2, 100, 20),
('2022-03-15',2, 100, 20),
('2022-04-30',2, 100, 20),
('2022-05-30',2, 100, 20),
('2022-06-23',2, 100, 20),
('2022-07-22',2, 100, 20),
('2022-08-01',2, 100, 20),
('2022-09-22',2, 100, 20),
('2022-10-01',2, 100, 20),
('2022-11-28',2, 100, 20),
('2022-12-13',2, 100, 20);
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	